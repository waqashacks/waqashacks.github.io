<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Endpoint Visibility with Sysmon - Advanced Detection in a Home SOC Lab</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    /* Additional styling for better readability */
    .content {
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.7;
    }
    
    .content h1 {
      font-size: 2.2em;
      margin-bottom: 20px;
      border-bottom: 2px solid #e1e4e8;
      padding-bottom: 10px;
    }
    
    .content h2 {
      font-size: 1.6em;
      margin-top: 40px;
      margin-bottom: 15px;
    }
    
    .content h3 {
      font-size: 1.3em;
      margin-top: 25px;
      margin-bottom: 12px;
    }
    
    .content p {
      margin-bottom: 15px;
    }
    
    .content ul, .content ol {
      margin-bottom: 20px;
      padding-left: 30px;
    }
    
    .content li {
      margin-bottom: 8px;
    }
    
    .content img {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .alert-box {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 4px;
      color: #856404;
    }
    
    .info-box {
      background-color: #d1ecf1;
      border-left: 4px solid #17a2b8;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 4px;
      color: #0c5460;
    }
    
    .critical-box {
      background-color: #f8d7da;
      border-left: 4px solid #dc3545;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 4px;
      color: #721c24;
    }
    
    .code-box {
      background-color: #f6f8fa;
      border: 1px solid #d1d5da;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
      color: #24292e;
    }
    
    .success-box {
      background-color: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 4px;
      color: #155724;
    }
  </style>
</head>
<body>

<div class="container">


  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Waqas Ibrahim</h2>
    <a href="../index.html">About Me</a>
    <a href="home-soc.html">Home SOC Lab</a>
    <a href="authentication-attacks.html">Authentication Attacks</a>
    <a href="sysmon-endpoint-detection.html">Sysmon Endpoint Detection</a>
  </div>

  <!-- Main Content -->
  <main class="content">

    <h1>Endpoint Visibility with Sysmon: Advanced Detection in a Home SOC Lab</h1>

    <p>
      Authentication monitoring tells you <em>who</em> logged in and <em>when</em>. But what if you need to know <em>what they did</em> after logging in? This is where traditional Windows logging falls short, and where advanced endpoint monitoring becomes critical.
    </p>

    <p>
      In this walkthrough, I deploy Sysmon (System Monitor) on a domain-joined endpoint to gain deep visibility into process execution, command-line arguments, network connections, and other critical security telemetry that standard Windows Event Logs simply don't provide.
    </p>

    <p>
      This lab demonstrates real-world SOC capabilities: deploying endpoint monitoring tools, detecting suspicious activity, and understanding when to escalate from Level 1 to Level 2 SOC analysts.
    </p>

    <h2>Introduction</h2>

    <p>
      In my previous blogs, I built a realistic SOC lab environment and detected authentication attacks using Windows Security Event Logs and Wazuh SIEM. While this provided valuable visibility into login activity, it left a critical gap: <strong>we could see authentication events, but not what happened after successful authentication</strong>.
    </p>

    <p>
      This is a fundamental limitation in SOC operations. An attacker who successfully authenticates (through credential theft, phishing, or brute force) can then execute malicious commands, establish persistence, move laterally, and exfiltrate data‚Äîall while appearing as a legitimate user in standard Windows logs.
    </p>

    <p>
      Sysmon fills this visibility gap by providing granular endpoint telemetry that enables SOC analysts to detect post-compromise activity.
    </p>

    <h2>Why Windows Security Logs Are Not Enough</h2>

    <p>
      Standard Windows Security Event Logs are valuable for authentication and access control monitoring, but they have significant limitations for threat detection.
    </p>

    <h3>What Windows Security Logs Tell You:</h3>
    <ul>
      <li><strong>Event ID 4624:</strong> A user successfully logged on</li>
      <li><strong>Event ID 4625:</strong> A login attempt failed</li>
      <li><strong>Event ID 4672:</strong> Special privileges assigned to new logon</li>
      <li><strong>Event ID 4648:</strong> A logon was attempted using explicit credentials</li>
    </ul>

    <h3>What Windows Security Logs DON'T Tell You:</h3>
    <ul>
      <li>What processes were executed after login</li>
      <li>Command-line arguments used when launching programs</li>
      <li>Parent-child process relationships</li>
      <li>Network connections initiated by processes</li>
      <li>Registry modifications for persistence</li>
      <li>DLL injections or code injection attempts</li>
      <li>File creation timestamps and hashes</li>
    </ul>

    <div class="critical-box">
      <strong>The SOC Gap:</strong> We know someone logged in successfully, but we have no visibility into what they did after authentication. This is exactly what attackers exploit‚Äîthey authenticate as legitimate users, then execute malicious activity that goes undetected.
    </div>

    <h2>What is Sysmon?</h2>

    <p>
      <strong>Sysmon (System Monitor)</strong> is a Windows system service and device driver from Microsoft Sysinternals that provides detailed telemetry about system activity.
    </p>

    <p>
      Unlike Windows Security Event Logs which focus on authentication and access control, Sysmon focuses on <strong>what actually happens on the endpoint</strong>‚Äîprocess execution, network activity, file operations, and registry changes.
    </p>

    <h3>Key Capabilities:</h3>
    <ul>
      <li><strong>Process Creation (Event ID 1):</strong> Every process executed, with full command-line arguments</li>
      <li><strong>Network Connections (Event ID 3):</strong> Every network connection initiated, including destination IPs and ports</li>
      <li><strong>Process Termination (Event ID 5):</strong> When processes end</li>
      <li><strong>Driver Loading (Event ID 6):</strong> Kernel drivers and rootkit indicators</li>
      <li><strong>Image Loading (Event ID 7):</strong> DLL injection detection</li>
      <li><strong>Registry Events (Event ID 12-14):</strong> Persistence mechanism detection</li>
      <li><strong>File Creation (Event ID 11):</strong> Malware dropper detection</li>
      <li><strong>DNS Queries (Event ID 22):</strong> Command-and-control communication</li>
    </ul>

    <h3>Why SOCs Use Sysmon:</h3>
    <ul>
      <li>Free and officially supported by Microsoft</li>
      <li>Lightweight with minimal performance impact</li>
      <li>Highly configurable through XML rules</li>
      <li>Integrates seamlessly with SIEM platforms</li>
      <li>Provides forensic-grade telemetry for incident investigation</li>
      <li>Detects advanced threats that bypass traditional antivirus</li>
    </ul>

    <div class="info-box">
      <strong>Enterprise Reality:</strong> Sysmon is widely deployed in enterprise SOC environments alongside EDR (Endpoint Detection and Response) solutions. It's considered essential for detecting sophisticated attacks, living-off-the-land techniques, and post-exploitation activity.
    </div>

    <h2>Administrator Access Requirement</h2>

    <p>
      Before proceeding with Sysmon deployment, it's critical to understand the privilege requirements.
    </p>

    <div class="critical-box">
      <strong>Administrator Access is 100% Required</strong><br><br>
      Sysmon installation and operation requires full administrative privileges on the endpoint. You MUST log in as <strong>THREATWATCH\Administrator</strong> or a user with local administrator rights.
    </div>

    <h3>Why Administrator Access is Required:</h3>

    <p>
      Sysmon operates at the kernel level and performs low-level system operations that standard users cannot execute:
    </p>

    <ul>
      <li><strong>Installs a kernel-mode driver</strong> (Sysmon64.sys) that hooks into the Windows operating system</li>
      <li><strong>Registers a Windows service</strong> (Sysmon64) that runs with SYSTEM privileges</li>
      <li><strong>Writes to protected registry locations</strong> to store configuration and operational data</li>
      <li><strong>Hooks low-level OS events</strong> such as process creation, network activity, and registry modifications</li>
      <li><strong>Intercepts system calls</strong> to capture detailed telemetry</li>
    </ul>

    <h3>What Happens Without Admin Rights:</h3>
    <ul>
      <li>‚ùå Installation will fail with "Access Denied" errors</li>
      <li>‚ùå Service registration will be blocked</li>
      <li>‚ùå Driver installation will fail</li>
      <li>‚ùå No logs will be generated</li>
      <li>‚ùå Sysmon will not function at all</li>
    </ul>

    <div class="info-box">
      <strong>SOC Lesson:</strong> All endpoint security tooling‚Äîwhether it's Sysmon, EDR agents, antivirus, or SIEM forwarders‚Äîrequires elevated privileges. This is a fundamental principle of endpoint security. In enterprise environments, deployment is typically automated through Group Policy or configuration management tools to ensure consistent administrative-level installation.
    </div>

    <h2>Lab Environment Verification</h2>

    <p>
      Before deploying Sysmon, I verified that my lab environment was properly configured and all components were operational.
    </p>

    <h3>Pre-Deployment Checklist:</h3>
    <ul>
      <li>‚úÖ <strong>HR-PC01:</strong> Windows 11 endpoint running and domain-joined</li>
      <li>‚úÖ <strong>DC01:</strong> Domain Controller operational</li>
      <li>‚úÖ <strong>Wazuh Manager:</strong> SIEM running on Ubuntu Server (192.168.10.20)</li>
      <li>‚úÖ <strong>Wazuh Agent:</strong> Deployed and active on HR-PC01</li>
      <li>‚úÖ <strong>Network Connectivity:</strong> All systems communicating within 192.168.10.0/24 subnet</li>
    </ul>

    <p>
      In the Wazuh dashboard, I navigated to <strong>Management ‚Üí Endpoints ‚Üí Agents</strong> to verify that HR-PC01 was actively reporting.
    </p>

    <img src="HR-PC01_Agent_is_live.png" alt="Wazuh Agent Active on HR-PC01" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      The agent status shows <strong>Active</strong>, confirming that the endpoint is connected to the SIEM and ready to forward Sysmon events once they're generated.
    </p>

    <p>
      Key details visible in the dashboard:
    </p>
    <ul>
      <li><strong>Agent ID:</strong> 006 (HR-PC01)</li>
      <li><strong>Status:</strong> Active (green indicator)</li>
      <li><strong>IP Address:</strong> 192.168.10.128</li>
      <li><strong>Operating System:</strong> Microsoft Windows 11 Enterprise</li>
      <li><strong>Wazuh Version:</strong> v4.7.2</li>
      <li><strong>Last Keep Alive:</strong> Active connection maintained</li>
    </ul>

    <div class="success-box">
      <strong>Lab Status:</strong> All components verified and operational. Environment is ready for Sysmon deployment.
    </div>

    <h2>Sysmon Deployment Process</h2>

    <h3>Step 1: Download Sysmon</h3>

    <p>
      On HR-PC01, logged in as <strong>THREATWATCH\Administrator</strong>, I navigated to the official Microsoft Sysinternals download page:
    </p>

    <div class="code-box">
      https://learn.microsoft.com/sysinternals/downloads/sysmon
    </div>

    <p>
      I downloaded <strong>Sysmon.zip</strong> and extracted it to <code>C:\Users\Administrator\Downloads\Sysmon</code>.
    </p>

    <img src="Sysmon_Extracted.png" alt="Sysmon Files Extracted" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      The extracted Sysmon package contains:
    </p>
    <ul>
      <li><strong>Sysmon.exe</strong> - 32-bit version</li>
      <li><strong>Sysmon64.exe</strong> - 64-bit version (what we'll use)</li>
      <li><strong>Sysmon64a.exe</strong> - ARM64 version</li>
      <li><strong>Eula.txt</strong> - End User License Agreement</li>
    </ul>

    <h3>Step 2: Download a Sysmon Configuration File</h3>

    <p>
      Sysmon without a configuration file is extremely noisy and generates thousands of low-value events. A properly tuned configuration is essential for SOC operations.
    </p>

    <p>
      I used the industry-standard <strong>SwiftOnSecurity Sysmon configuration</strong>, which is:
    </p>
    <ul>
      <li>Widely adopted by enterprise SOCs</li>
      <li>Focused on detecting malicious activity while filtering benign noise</li>
      <li>Actively maintained and updated with new threat intelligence</li>
      <li>Tuned to balance detection coverage with performance impact</li>
    </ul>

    <p>
      Downloaded from:
    </p>

    <div class="code-box">
      https://github.com/SwiftOnSecurity/sysmon-config
    </div>

    <p>
      I saved the configuration file as <strong>sysmonconfig-export.xml</strong> and placed it in the Sysmon directory.
    </p>

    <img src="sysmon_config_in_sysmon_folder.png" alt="Sysmon Configuration File" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <div class="info-box">
      <strong>Configuration Best Practice:</strong> Never deploy Sysmon without a configuration file. Unconfigured Sysmon generates excessive events that overwhelm SIEM storage and make analysis impossible. In enterprise environments, configurations are customized based on organizational risk profile and SIEM capacity.
    </div>

    <h3>Step 3: Install Sysmon</h3>

    <p>
      With administrator privileges, I opened Command Prompt and navigated to the Sysmon directory:
    </p>

    <div class="code-box">
      C:\Users\Administrator\Downloads\Sysmon>
    </div>

    <p>
      Installation command:
    </p>

    <div class="code-box">
      Sysmon64.exe -accepteula -i sysmonconfig-export.xml
    </div>

    <p>
      <strong>Command Breakdown:</strong>
    </p>
    <ul>
      <li><code>Sysmon64.exe</code> - 64-bit Sysmon executable</li>
      <li><code>-accepteula</code> - Automatically accept the license agreement (required for automated deployment)</li>
      <li><code>-i</code> - Install Sysmon</li>
      <li><code>sysmonconfig-export.xml</code> - Apply this configuration file</li>
    </ul>

    <img src="Successfully_installed_sysmon_output.png" alt="Successful Sysmon Installation" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      Installation output confirms successful deployment:
    </p>

    <div class="code-box">
System Monitor v15.15 - System activity monitor
By Mark Russinovich and Thomas Garnier
Copyright (C) 2014-2024 Microsoft Corporation
Using libxml2. libxml2 is Copyright (C) 1998-2012 Daniel Veillard. All Rights Reserved.
Sysinternals - www.sysinternals.com

Loading configuration file with schema version 4.90
Sysmon schema version: 4.90
Configuration file validated.
Sysmon64 installed.
SysmonDrv installed.
Starting SysmonDrv.
SysmonDrv started.
Starting Sysmon64..
Sysmon64 started.
    </div>

    <p>
      Key installation events:
    </p>
    <ul>
      <li>‚úÖ Configuration file validated (schema version 4.90)</li>
      <li>‚úÖ Sysmon64 service installed</li>
      <li>‚úÖ SysmonDrv kernel driver installed</li>
      <li>‚úÖ Driver started successfully</li>
      <li>‚úÖ Sysmon service started successfully</li>
    </ul>

    <h3>Step 4: Verify Sysmon Service is Running</h3>

    <p>
      To confirm Sysmon is operational, I queried the service status:
    </p>

    <div class="code-box">
      sc query sysmon64
    </div>

    <img src="sysmon_service_running.png" alt="Sysmon Service Running" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      Service status output:
    </p>

    <div class="code-box">
SERVICE_NAME: sysmon64
    TYPE               : 10  WIN32_OWN_PROCESS
    STATE              : 4  RUNNING
                         (STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
    WIN32_EXIT_CODE    : 0  (0x0)
    SERVICE_EXIT_CODE  : 0  (0x0)
    CHECKPOINT         : 0x0
    WAIT_HINT          : 0x0
    </div>

    <p>
      <strong>STATE: 4 RUNNING</strong> confirms that Sysmon is actively monitoring the endpoint.
    </p>

    <div class="success-box">
      <strong>Deployment Status:</strong> Sysmon successfully installed and running. The endpoint is now generating advanced telemetry.
    </div>

    <h2>Verifying Sysmon Event Generation</h2>

    <p>
      Installing Sysmon is only the first step. The critical validation is confirming that events are being generated and can be analyzed.
    </p>

    <h3>Step 1: Check Windows Event Viewer</h3>

    <p>
      Sysmon writes events to a dedicated Windows Event Log channel. I navigated to:
    </p>

    <div class="code-box">
      Event Viewer ‚Üí Applications and Services Logs ‚Üí Microsoft ‚Üí Windows ‚Üí Sysmon ‚Üí Operational
    </div>

    <img src="sysmon_event_ID_1_Details.png" alt="Sysmon Event ID 1 - Process Creation" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      The Event Viewer shows multiple Sysmon events, including <strong>Event ID 1 (Process Create)</strong>, which is the most valuable for threat detection.
    </p>

    <h3>Analyzing Event ID 1 (Process Creation):</h3>

    <p>
      Event ID 1 captures every process execution on the endpoint with forensic-level detail. The screenshot shows a typical process creation event with the following key fields:
    </p>

    <ul>
      <li><strong>RuleName:</strong> Configuration rule that triggered this event</li>
      <li><strong>UtcTime:</strong> 2026-02-05 02:18:35.227 (precise timestamp)</li>
      <li><strong>ProcessGuid:</strong> {c0fb8278-fdfb-6983-4a02-000000001500} (unique identifier)</li>
      <li><strong>ProcessId:</strong> 3508</li>
      <li><strong>Image:</strong> C:\Windows\System32\smartscreen.exe</li>
      <li><strong>FileVersion:</strong> 10.0.26100.7309 (WinBuild.160101.0800)</li>
      <li><strong>Description:</strong> Windows Defender SmartScreen</li>
      <li><strong>Product:</strong> Microsoft¬Æ Windows¬Æ Operating System</li>
      <li><strong>Company:</strong> Microsoft Corporation</li>
      <li><strong>OriginalFileName:</strong> smartscreen.exe</li>
      <li><strong>CommandLine:</strong> C:\Windows\System32\smartscreen.exe -Embedding</li>
      <li><strong>CurrentDirectory:</strong> C:\WINDOWS\system32\</li>
      <li><strong>User:</strong> THREATWATCH\Administrator</li>
      <li><strong>LogonGuid:</strong> {c0fb8278-f9d7-6983-de3b-0d0000000000}</li>
      <li><strong>LogonId:</strong> 0xd3bde</li>
      <li><strong>TerminalSessionId:</strong> 1</li>
      <li><strong>IntegrityLevel:</strong> High</li>
      <li><strong>Hashes:</strong> MD5=9B88573E62B963686847D9C9D09C7D9C,SHA256=320529DAD57BEC40F067BAA8A4E0E5596061F...(truncated)</li>
      <li><strong>ParentProcessGuid:</strong> {c0fb8278-6973-6981-0d00-000000001500}</li>
      <li><strong>ParentProcessId:</strong> 916</li>
      <li><strong>ParentImage:</strong> C:\Windows\System32\svchost.exe</li>
      <li><strong>ParentCommandLine:</strong> C:\WINDOWS\system32\svchost.exe -k DcomLaunch -p</li>
    </ul>

    <div class="info-box">
      <strong>SOC Analysis Value:</strong> The <strong>CommandLine</strong> and <strong>ParentImage</strong> fields are critical for detecting malicious activity. Standard Windows Event Logs don't capture command-line arguments, making it impossible to distinguish between legitimate system processes and malicious use of trusted binaries (living-off-the-land attacks).
    </div>

    <h2>Detection Scenario: Suspicious PowerShell Execution</h2>

    <p>
      To demonstrate Sysmon's detection capabilities, I simulated a common attack technique: executing PowerShell with suspicious flags that are frequently used by attackers to evade detection.
    </p>

    <h3>Attack Simulation:</h3>

    <p>
      On HR-PC01, I executed:
    </p>

    <div class="code-box">
      powershell -nop -w hidden
    </div>

    <p>
      <strong>What these flags mean:</strong>
    </p>
    <ul>
      <li><code>-nop</code> (NoProfile) - Bypasses PowerShell profile scripts that might log or restrict execution</li>
      <li><code>-w hidden</code> (WindowStyle Hidden) - Hides the PowerShell window from the user</li>
    </ul>

    <h3>Why This is Suspicious:</h3>

    <p>
      Legitimate PowerShell usage rarely requires hidden windows or profile bypasses. These flags are commonly seen in:
    </p>
    <ul>
      <li>Malware delivery (downloaders, droppers)</li>
      <li>Fileless malware execution</li>
      <li>Credential theft (Mimikatz, PowerSploit)</li>
      <li>Lateral movement (PsExec, WMI abuse)</li>
      <li>Command-and-control communication</li>
      <li>Living-off-the-land attacks</li>
    </ul>

    <div class="critical-box">
      <strong>Attacker Perspective:</strong> PowerShell is a powerful administrative tool that's present on every modern Windows system. Attackers abuse it because it's trusted, widely deployed, and provides extensive capabilities for post-exploitation. Hiding the window and bypassing profiles helps evade casual observation by users or helpdesk personnel.
    </div>

    <h2>Wazuh Detection and SIEM Analysis</h2>

    <p>
      The Sysmon agent forwarded the PowerShell execution events to the Wazuh SIEM, where they appeared in the Security Events dashboard.
    </p>

    <img src="Powershell_execution_1.png" alt="Wazuh PowerShell Detection - Security Alerts" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      The Wazuh dashboard shows multiple security alerts related to PowerShell activity:
    </p>

    <h3>Alert Analysis:</h3>

    <table style="width:100%; border-collapse: collapse; margin: 20px 0;">
      <tr style="background-color: #f6f8fa;">
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Time</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Technique</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Tactic</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Description</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Level</th>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:50:25.352</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1546.011</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Privilege Escalation, Persistence</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Application Compatibility Database launched</td>
        <td style="border: 1px solid #ddd; padding: 10px;">12</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:21:55.118</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.003</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Windows command prompt started by an abnormal process</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:18:15.453</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.003</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Windows command prompt started by an abnormal process</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:17:21.388</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.003</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Windows command prompt started by an abnormal process</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:11:35.305</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.001</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Suspicious location launched binary</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
    </table>

    <p>
      <strong>MITRE ATT&CK Mapping:</strong>
    </p>
    <ul>
      <li><strong>T1059.001</strong> - Command and Scripting Interpreter: PowerShell</li>
      <li><strong>T1059.003</strong> - Command and Scripting Interpreter: Windows Command Shell</li>
      <li><strong>T1546.011</strong> - Event Triggered Execution: Application Shimming</li>
    </ul>

    <img src="Powershell_execution_2.png" alt="Wazuh PowerShell Detection - Detailed Events" style="max-width: 800px; width: 100%; height: auto; margin: 20px auto; display: block; border: 1px solid #ddd; border-radius: 4px;">

    <p>
      Additional high-severity alerts detected:
    </p>

    <table style="width:100%; border-collapse: collapse; margin: 20px 0;">
      <tr style="background-color: #f6f8fa;">
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Time</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Technique</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Tactic</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Description</th>
        <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Level</th>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 04:06:39.636</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1105</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Command and Control</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Executable file dropped in folder commonly used by malware</td>
        <td style="border: 1px solid #ddd; padding: 10px;">15</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 04:06:39.634</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.001</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Powershell process spawned powershell instance</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 04:06:18.579</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1105</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Command and Control</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Executable file dropped in folder commonly used by malware</td>
        <td style="border: 1px solid #ddd; padding: 10px;">15</td>
      </tr>
      <tr>
        <td style="border: 1px solid #ddd; padding: 10px;">Feb 5, 03:59:03.003</td>
        <td style="border: 1px solid #ddd; padding: 10px;">T1059.003</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Execution</td>
        <td style="border: 1px solid #ddd; padding: 10px;">Windows command prompt started by abnormal process</td>
        <td style="border: 1px solid #ddd; padding: 10px;">4</td>
      </tr>
    </table>

    <p>
      <strong>Critical Findings:</strong>
    </p>
    <ul>
      <li>üî¥ <strong>Level 15 Alert:</strong> Executable file dropped in malware-associated folder (T1105 - Ingress Tool Transfer)</li>
      <li>üü† <strong>Level 12 Alert:</strong> Application Compatibility Database abuse (T1546.011 - Persistence mechanism)</li>
      <li>üü° <strong>Level 4 Alerts:</strong> Multiple abnormal PowerShell and command prompt executions</li>
    </ul>

    <div class="alert-box">
      <strong>SOC Analyst Note:</strong> The combination of suspicious PowerShell execution, file drops in unusual locations, and persistence mechanisms creates a high-confidence indicator of malicious activity. This pattern warrants immediate investigation.
    </div>

    <h2>SOC Level 1 Investigation Workflow</h2>

    <p>
      When these alerts appear in a production SOC environment, a Level 1 (L1) analyst would follow a structured triage process to determine severity and decide whether escalation is required.
    </p>

    <h3>Step 1: Initial Alert Triage</h3>

    <p>
      The L1 analyst's first task is to gather basic context:
    </p>

    <ul>
      <li><strong>What triggered the alert?</strong> PowerShell execution with suspicious flags (-nop, -w hidden)</li>
      <li><strong>Which system?</strong> HR-PC01 (192.168.10.128)</li>
      <li><strong>Which user?</strong> THREATWATCH\Administrator</li>
      <li><strong>When?</strong> Feb 5, 2026 @ 03:00-04:00 UTC</li>
      <li><strong>How many events?</strong> Multiple related alerts within one hour</li>
    </ul>

    <h3>Step 2: Context Analysis</h3>

    <p>
      The analyst asks investigative questions to understand whether this is legitimate or malicious:
    </p>

    <ul>
      <li><strong>User Authorization:</strong> Is the Administrator account expected to run PowerShell at this time?</li>
      <li><strong>Business Context:</strong> Are there scheduled tasks, maintenance windows, or IT operations that would explain this?</li>
      <li><strong>Process Lineage:</strong> What was the parent process? (Check ParentImage field in Sysmon Event ID 1)</li>
      <li><strong>Command Line:</strong> What were the exact arguments? Are they consistent with legitimate use?</li>
      <li><strong>Network Activity:</strong> Did PowerShell make any outbound connections? (Check Sysmon Event ID 3)</li>
      <li><strong>File Operations:</strong> Were any files created or modified? (Check Sysmon Event ID 11)</li>
    </ul>

    <h3>Step 3: Correlation and Pattern Recognition</h3>

    <p>
      The analyst looks for related indicators:
    </p>

    <ul>
      <li>Are there similar alerts on other endpoints?</li>
      <li>Have there been recent authentication failures for this user?</li>
      <li>Were any files downloaded or executed shortly before the PowerShell activity?</li>
      <li>Are there registry modifications indicating persistence? (Sysmon Event ID 13)</li>
      <li>Is this behavior consistent with known threat actor tactics?</li>
    </ul>

    <h3>Step 4: Severity Classification</h3>

    <div class="info-box">
      <strong>L1 Decision Matrix:</strong><br><br>
      
      <strong>Low Severity (Monitor):</strong><br>
      - Legitimate administrative activity during approved maintenance window<br>
      - PowerShell launched by trusted deployment tools<br>
      - User can verify and explain the activity<br><br>
      
      <strong>Medium Severity (Investigate Further):</strong><br>
      - Unexpected timing but plausible explanation<br>
      - Unusual but not clearly malicious command-line arguments<br>
      - Single occurrence without other indicators<br><br>
      
      <strong>High Severity (Escalate to L2):</strong><br>
      - Multiple suspicious indicators (PowerShell + file drops + persistence)<br>
      - User denies initiating the activity<br>
      - Command-line arguments consistent with known attack techniques<br>
      - Lateral movement or privilege escalation indicators<br>
      - Network connections to suspicious or unknown IPs
    </div>

    <h3>Step 5: Escalation Decision</h3>

    <p>
      Based on the findings in this scenario, the L1 analyst would escalate to Level 2 (L2) for the following reasons:
    </p>

    <ul>
      <li>‚úÖ <strong>Level 15 Alert:</strong> Executable dropped in malware-associated location</li>
      <li>‚úÖ <strong>Multiple Techniques:</strong> T1059.001, T1105, T1546.011 (Execution + C2 + Persistence)</li>
      <li>‚úÖ <strong>Suspicious Flags:</strong> -nop and -w hidden are attacker tradecraft</li>
      <li>‚úÖ <strong>Behavioral Pattern:</strong> File drops followed by PowerShell execution indicates potential malware delivery</li>
      <li>‚úÖ <strong>Persistence Indicators:</strong> Application Compatibility Database modifications suggest long-term access attempt</li>
    </ul>

    <div class="critical-box">
      <strong>Escalation to L2 SOC Analyst:</strong><br><br>
      <strong>Summary:</strong> Multiple high-severity alerts on HR-PC01 indicating potential malware execution via PowerShell.<br><br>
      <strong>Indicators:</strong><br>
      - PowerShell execution with evasion flags (-nop, -w hidden)<br>
      - Executable file dropped in C:\Windows\Temp (common malware staging location)<br>
      - Application shim persistence mechanism detected<br>
      - User: THREATWATCH\Administrator<br>
      - Timeframe: Feb 5, 2026 03:00-04:00 UTC<br><br>
      <strong>Recommended L2 Actions:</strong><br>
      - Full forensic analysis of PowerShell command history<br>
      - Memory dump and malware analysis of dropped executable<br>
      - Network traffic analysis for C2 indicators<br>
      - Check for lateral movement to other systems<br>
      - Consider endpoint isolation pending investigation
    </div>

    <h2>What This Lab Taught Me - SOC Level 1 Skills</h2>

    <p>
      This Sysmon deployment and detection scenario reinforced critical SOC analyst capabilities:
    </p>

    <h3>1. Endpoint Telemetry Analysis</h3>
    <ul>
      <li>Understanding the difference between authentication logs and process execution logs</li>
      <li>Recognizing the value of command-line arguments in threat detection</li>
      <li>Analyzing parent-child process relationships to identify anomalies</li>
      <li>Correlating multiple event types (process creation, file operations, registry changes)</li>
    </ul>

    <h3>2. MITRE ATT&CK Framework Application</h3>
    <ul>
      <li>Mapping observed behavior to documented attacker techniques</li>
      <li>Understanding tactics (Execution, Persistence, Command and Control)</li>
      <li>Recognizing technique combinations that indicate multi-stage attacks</li>
      <li>Using ATT&CK IDs for standardized threat communication</li>
    </ul>

    <h3>3. Alert Triage and Prioritization</h3>
    <ul>
      <li>Distinguishing between low-noise informational events and actionable alerts</li>
      <li>Assessing alert severity based on context and correlation</li>
      <li>Identifying when to escalate from L1 to L2 investigation</li>
      <li>Documenting findings clearly for incident handoff</li>
    </ul>

    <h3>4. Threat Hunting Fundamentals</h3>
    <ul>
      <li>Proactively searching for suspicious PowerShell execution</li>
      <li>Identifying living-off-the-land attack techniques</li>
      <li>Recognizing common attacker evasion tactics (hidden windows, profile bypasses)</li>
      <li>Understanding why certain command-line flags are inherently suspicious</li>
    </ul>

    <h2>What This Lab Taught Me - Helpdesk Level 1 Skills</h2>

    <p>
      Interestingly, this lab also reinforced fundamental IT administration skills that are valuable for SOC analysts who transition from Helpdesk roles:
    </p>

    <h3>1. Administrator Privilege Awareness</h3>
    <ul>
      <li>Understanding why endpoint security tools require admin rights</li>
      <li>Recognizing the implications of SYSTEM-level service installation</li>
      <li>Explaining privilege requirements to non-technical stakeholders</li>
    </ul>

    <h3>2. Windows Service Management</h3>
    <ul>
      <li>Verifying service installation and status using <code>sc query</code></li>
      <li>Understanding service states (RUNNING, STOPPED, STOPPABLE)</li>
      <li>Troubleshooting service startup failures</li>
    </ul>

    <h3>3. Event Viewer Navigation</h3>
    <ul>
      <li>Locating custom event log channels (Sysmon/Operational)</li>
      <li>Filtering events by Event ID, timestamp, and severity</li>
      <li>Exporting logs for escalation or analysis</li>
    </ul>

    <h3>4. Software Deployment Validation</h3>
    <ul>
      <li>Confirming installation success through multiple verification methods</li>
      <li>Checking that configuration files are properly applied</li>
      <li>Validating that expected functionality is operational</li>
    </ul>

    <div class="info-box">
      <strong>Career Insight:</strong> Many successful SOC analysts come from Helpdesk backgrounds. The troubleshooting skills, Windows administration knowledge, and user interaction experience from Helpdesk work translate directly to SOC operations. This lab demonstrates how technical competencies build on each other across IT security roles.
    </div>

    <h2>Key Takeaways</h2>

    <p>
      This exercise demonstrated the complete lifecycle of endpoint security enhancement:
    </p>

    <ul>
      <li><strong>Gap Identification:</strong> Windows Security Logs don't provide sufficient visibility into post-authentication activity</li>
      <li><strong>Tool Selection:</strong> Sysmon fills this gap with detailed process, network, and registry telemetry</li>
      <li><strong>Deployment:</strong> Proper installation requires admin rights, validated configuration, and service verification</li>
      <li><strong>Integration:</strong> Sysmon events automatically forward to Wazuh SIEM for centralized analysis</li>
      <li><strong>Detection:</strong> Suspicious PowerShell execution triggered multiple correlated alerts</li>
      <li><strong>Investigation:</strong> L1 analyst workflow identified high-severity indicators requiring L2 escalation</li>
      <li><strong>Response:</strong> Documented findings and recommended forensic investigation</li>
    </ul>

    <div class="success-box">
      <strong>Real-World Application:</strong> This exact scenario‚Äîdeploying Sysmon, tuning detection rules, investigating PowerShell abuse, and escalating to L2‚Äîhappens daily in enterprise SOCs. The skills demonstrated here are directly applicable to SOC analyst positions.
    </div>

    <h2>Next Steps and Future Enhancements</h2>

    <p>
      This lab can be expanded with additional capabilities:
    </p>

    <h3>Technical Enhancements:</h3>
    <ul>
      <li><strong>Sysmon Configuration Tuning:</strong> Customize rules for organizational-specific threats</li>
      <li><strong>Additional Event IDs:</strong> Enable Network Connection (ID 3), DNS Query (ID 22), and Registry (ID 13) monitoring</li>
      <li><strong>Automated Response:</strong> Create Wazuh active response rules to isolate endpoints on high-severity alerts</li>
      <li><strong>Threat Intel Integration:</strong> Feed known-bad hashes and IPs into detection rules</li>
      <li><strong>Baseline Establishment:</strong> Document normal PowerShell usage to improve false positive reduction</li>
    </ul>

    <h3>Attack Simulations:</h3>
    <ul>
      <li><strong>Credential Dumping:</strong> Detect Mimikatz or similar tools via Sysmon</li>
      <li><strong>Lateral Movement:</strong> Simulate PsExec or WMI-based movement between endpoints</li>
      <li><strong>Persistence Mechanisms:</strong> Test detection of registry run keys, scheduled tasks, WMI event subscriptions</li>
      <li><strong>Command and Control:</strong> Simulate C2 beaconing and detect via network connection events</li>
      <li><strong>Data Exfiltration:</strong> Monitor for unusual file access patterns and large data transfers</li>
    </ul>

    <h3>Analysis Workflows:</h3>
    <ul>
      <li><strong>Incident Response Playbooks:</strong> Document step-by-step investigation procedures for common alert types</li>
      <li><strong>Escalation Criteria:</strong> Define clear thresholds for L1 to L2 handoff</li>
      <li><strong>Metrics and KPIs:</strong> Track MTTD (Mean Time to Detect) and MTTR (Mean Time to Respond)</li>
    </ul>

    <h2>Final Thoughts</h2>

    <p>
      Deploying Sysmon transformed my home lab from a basic authentication monitoring environment into a production-grade endpoint detection platform. The visibility gained from process-level telemetry fundamentally changes threat detection capabilities.
    </p>

    <p>
      Without Sysmon, I could see <em>who</em> logged in. With Sysmon, I can see <em>what they did</em>‚Äîevery process executed, every network connection made, every registry key modified. This is the difference between perimeter security and defense in depth.
    </p>

    <p>
      More importantly, this lab reinforced the critical thinking skills that separate competent SOC analysts from those who simply acknowledge alerts. Understanding <em>why</em> PowerShell with <code>-nop -w hidden</code> is suspicious, <em>how</em> to correlate it with file drops and persistence mechanisms, and <em>when</em> to escalate to L2‚Äîthese are the judgment calls that define effective SOC operations.
    </p>

    <p>
      This is the kind of work I want to do professionally: building detection capabilities, investigating security events, and contributing to organizational defense. Every alert is an opportunity to learn, and every investigation sharpens analytical skills.
    </p>

    <p>
      If you're a recruiter reading this, know that this lab represents more than technical capability‚Äîit demonstrates curiosity, initiative, and the ability to translate theory into practice. I built this environment on my own time because I'm genuinely passionate about cybersecurity. I didn't wait for a job to start learning SOC operations; I created my own SOC.
    </p>

    <p>
      That's the mindset I'll bring to your team.
    </p>

  </main>

</div>

</body>
</html>
